# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

## Common Development Commands

### Development
```bash
npm run dev          # Start development server with hot reload on port 5000
npm run build        # Build production bundle (frontend + backend)
npm start           # Run production server
npm run check       # TypeScript type checking
npm run db:push     # Push database schema changes using Drizzle
```

### Testing & Verification
```bash
# The project uses TypeScript for type safety - run type checking:
npm run check

# For database changes, always push schema updates:
npm run db:push
```

## Architecture Overview

### Full-Stack Structure
This is a **MERN-style** application with a **monorepo architecture**:
- **Frontend**: React + TypeScript + Vite (in `/client`)
- **Backend**: Express.js + TypeScript (in `/server`) 
- **Shared**: Common types and schemas (in `/shared`)
- **Database**: PostgreSQL with Drizzle ORM
- **External Services**: Supabase (auth/storage), Google Gemini AI

### Key Architectural Patterns

**Monorepo Organization**:
- Single `package.json` with unified build process
- Shared TypeScript types between frontend/backend via `/shared` folder
- Path aliases: `@/*` for client components, `@shared/*` for shared types

**Database Layer**:
- Drizzle ORM with PostgreSQL (via Neon/Supabase)
- Schema defined in `shared/schema.ts` with Zod validation
- Fallback in-memory storage for development (`storage.ts`)
- Core entities: Users, Files, Conversations, Messages

**Authentication & Sessions**:
- Express sessions with bcrypt password hashing
- Session-based auth (not JWT) stored server-side
- Auth middleware in `server/services/auth.ts`

**File Processing Pipeline**:
1. Multer handles multipart uploads to temp directory
2. `pdf-parse` extracts text content from PDFs
3. Files uploaded to Supabase Storage
4. Local temp files cleaned up after processing
5. File metadata stored in PostgreSQL

**AI Integration**:
- Google Gemini 2.5 Flash model for document Q&A
- Context includes PDF content + conversation history (last 10 messages)
- Conversation titles auto-generated by AI

### Environment Setup

Required environment variables (see `.env.example`):
```bash
DATABASE_URL=           # Supabase PostgreSQL connection
SUPABASE_URL=          # Supabase project URL  
SUPABASE_ANON_KEY=     # Supabase anonymous key
GEMINI_API_KEY=        # Google Gemini API key
SESSION_SECRET=        # Session encryption secret
```

### Development Notes

**Frontend Architecture**:
- Uses Wouter for lightweight routing (not React Router)
- Framer Motion for animations
- shadcn/ui + Radix UI components with Tailwind CSS
- React Query for server state management

**API Design**:
- RESTful endpoints under `/api/*`
- Consistent error handling with proper HTTP status codes
- Request/response logging middleware for development
- All protected routes require authentication

**Database Migrations**:
- Use Drizzle Kit: `npm run db:push` to apply schema changes
- Schema changes should be made in `shared/schema.ts`
- No separate migration files - Drizzle handles schema diffing

**File Upload Security**:
- Only PDF files allowed (MIME type validation)
- Files processed and stored in Supabase, not locally
- Temporary files automatically cleaned up on success/failure

**Replit Deployment**:
- Configured for Replit with `.replit` file
- Auto-scaling deployment target
- Uses PostgreSQL module and web hosting